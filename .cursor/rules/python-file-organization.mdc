---
description: Python file size limits and function extraction guidelines
tags: [python, organization, refactoring]
---

# Python File Organization

## File Size Limits

| Threshold | Lines | Action |
|-----------|-------|--------|
| Target | 300-400 | Ideal file size |
| Warning | 400-500 | Consider extraction |
| Hard Limit | 500+ | Must refactor |

**Exception**: Test files can exceed limits if testing a single module comprehensively.

## When to Extract

Extract code into separate modules when:

1. **File exceeds 400 lines**
2. **Class has multiple responsibilities** (violates SRP)
3. **Related functions form a cohesive concept** (e.g., "websocket_handlers", "trading_actions")
4. **Same pattern appears in multiple places**

## Extraction Patterns

### Pure Functions (no `self` state needed)

```python
# Before: method in large class
class Dashboard:
    def calculate_momentum(self, prices, timeframe):
        # 20 lines of pure calculation

# After: extract to utility module
# utils/calculations.py
def calculate_momentum(prices: list, timeframe: int) -> float:
    # 20 lines of pure calculation
```

### Handler Classes (need limited state)

```python
# Before: handler methods scattered in main class
class Dashboard:
    def handle_price_update(self, data): ...
    def handle_trade_update(self, data): ...

# After: extract to handler module with callbacks
# handlers/messages.py
class MessageHandler:
    def __init__(self, on_price_update, on_trade_update):
        self.on_price_update = on_price_update
        self.on_trade_update = on_trade_update
```

### Action Functions (keybindings, commands)

```python
# Before: many action_* methods in main class
class Dashboard:
    def action_reset(self): ...
    def action_pause(self): ...

# After: extract to actions module
# actions/dashboard_actions.py
def create_reset_action(trader, log_fn):
    def reset():
        trader.reset()
        log_fn("Reset complete")
    return reset
```

## Module Naming Conventions

| Folder | Purpose |
|--------|---------|
| `handlers/` | Event handlers and callbacks |
| `actions/` | User-triggered actions (keybindings, commands) |
| `utils/` | Pure utility functions with no side effects |
| `services/` | Stateful business logic classes |

## Readability Benefits

Extracting to well-named functions/modules:
- **Function names** describe intent (what it does)
- **Module names** describe domain (what area it covers)
- **Smaller files** are easier to navigate
- **Import statements** act as a table of contents
